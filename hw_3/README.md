## Запуск всего

### Запуск докера:

```
docker-compose build
docker-compose up -d
```

### Запуск Мафии (также описан в ../hw_2)

Запуск сервера:

```
docker-compose run mafia_server
```

Запуск одного клиента Мафии в отдельной консоли:
```
docker-compose run mafia_client {session_name} {user_name} {users_count}
```
Где {session_name} - название сессии, к которой хочется подключиться, {user_name} - имя пользователя, {users_count} - необязательное поле, задающее количество игроков.
{users_count} учитывается только у первого подключившегося к сессии клиента. Если первый клиент не указал {users_count}, сессия заводится на 4 человека.

Для игры нужно запустить {users_count} клиентов с одним и тем же {session_name} и разными {user_name}

Например, самый простой способ начать игру - запустить 4 консоли со следующими командами:

```
docker-compose run mafia_client session user1
docker-compose run mafia_client session user2
docker-compose run mafia_client session user3
docker-compose run mafia_client session user4
```

Чтобы начать игру на 8 человек (там будет 2 мафии) - запустить 8 консолей со следующими командами:

```
docker-compose run mafia_client session user1
docker-compose run mafia_client session user2
docker-compose run mafia_client session user3
docker-compose run mafia_client session user4
docker-compose run mafia_client session user5
docker-compose run mafia_client session user6
docker-compose run mafia_client session user7
docker-compose run mafia_client session user8
```

После каждого присоединенного пользователя на каждый клиент придет сообщение о новом пользователе и о текущих пользователях в сессии.

### Запуск чата

Запуск сервера:

```
docker-compose run server
```

Запуск одного клиента Чата в отдельной консоли:
```
docker-compose run client {session_name} {user_name}
```
Где {session_name} - название сессии, к которой хочется подключиться, {user_name} - имя пользователя. Чтобы Чат был синхронизирован с Мафией, названия {session_name} и {user_name} должны совпадать с этим же пользователем в Мафии.

Например, для игры в 4 человека нужно запустить 4 чат-консоли со следующими командами:

```
docker-compose run client session user1
docker-compose run client session user2
docker-compose run client session user3
docker-compose run client session user4
```

Чтобы начать игру на 8 человек (там будет 2 мафии) - запустить 8 консолей со следующими командами:

```
docker-compose run client session user1 8
docker-compose run client session user2
docker-compose run client session user3
docker-compose run client session user4
docker-compose run client session user5
docker-compose run client session user6
docker-compose run client session user7
docker-compose run client session user8
```


## Процесс игры в Мафию (происходит в mafia_client, описан также в ../hw_2)

Ход игры:
1. Когда набирается {users_count} человек, игра автоматически начинается. Каждому игроку приходит сообщение с его ролью, выбранной случайно ({users_count} / 4 мафий, 1 комиссар, остальные мирные)
2. Игра начинается с дня.
3. Днем игроки общаются и предполагают, кто мафия. День заканчивается, когда все игроки сказали, что готовы его закончить. Игрок, которого "обвинили" более половины живых игроков, умирает.
4. Ночью игроки спят. Комиссар проверяет одного человека. Мафия сговаривается и убивает <= 1 человека. Ночь заканчивается, когда мафия и комиссар сделали свои действия.
5. Игра заканчивается победой мирных, если мафия убита. Игра заканчивается победой мафии, если мирных игроков (включая комиссара) осталось не больше, чем мафии.

Команды, доступные живым игрокам:
* help - выводит для запросившего список всех команд и их объяснения. Применять можно в любой стадии игры любому персонажу.
* chat {text} - отправляет сообщение {text} всем персонажам. Применять можно всем персонажам, но не ночью. Ночью команду может использовать только мафия и сообщения доставляются только мафии
* end_day - сообщает о том, что игрок готов закончить день (об этом знает только отправивший). Когда все живые игроки прожали end_day, день заканчивается. Применять можно всем игрокам, но только днем.
* check {user_name} - проверяет пользователя {user_name}. Сообщает, мафия этот пользователь или нет. Использовать может только комиссар и только ночью.
* kill {user_name} - записывает голос мафии на убийство пользователя {user_name}. Если за одного и того же человека ночью проголосовало больше половины живых мафий, этот человек умирает утром. Использовать может только мафия и только ночью.
* publish - публикует найденных мафий всем пользователям. Использовать может только комиссар, только днем и только если хотя бы в одну из предыдущих ночей он обнаружил мафию.
* blame {user_name} - обвиняет {user_name} в том, что он мафия. Никто, кроме отправившего, не видит этого голоса. Если за пользователя проголосовало больше половины живых игроков, в конце дня он умирает.

Мертвые игроки могут использовать только команду "help"

## Процесс Чата

* Чтобы отправить сообщение, достаточно набрать его в консоли Чата и нажать ENTER. Сообщение автоматически отправится всем участникам чата
* Если в Мафии идет игра с тем же названием и в ней ночь, писать друг другу могут только игроки с ролью "мафия". Сообщения, написанные ночью другими игроками, доставляться не будут
